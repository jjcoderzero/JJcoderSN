# CAP理论中的P到底是个什么意思？

在CAP理论中，C代表一致性，A代表可用性（在一定时间内，用户的请求都会得到应答），P代表分区容错。
这里分区容错到底是指数据上的多个备份还是说其它的 ？ 我感觉分布式系统中，CAP理论应该是C和A存在不可同时满足， 既要保证高可用，又要保证强一致性，因为多个节点之间存在数据复制，所以要么保证强一致性，就不一定能在指定的时间内返回客户的请求， 要么保证高可用，但是各个节点的数据不一定是一致的。 但是和P有什么关系呢 ？

回答一：

一个分布式系统里面，节点组成的网络本来应该是连通的。然而可能因为一些故障，使得有些节点之间不连通了，整个网络就分成了几块区域。数据就散布在了这些不连通的区域中。这就叫分区。当你一个数据项只在一个节点中保存，那么分区出现后，和这个节点不连通的部分就访问不到这个数据了。这时分区就是无法容忍的。提高分区容忍性的办法就是一个数据项复制到多个节点上，那么出现分区之后，这一数据项就可能分布到各个区里。容忍性就提高了。然而，要把数据复制到多个节点，就会带来一致性的问题，就是多个节点上面的数据可能是不一致的。要保证一致，每次写操作就都要等待全部节点写成功，而这等待又会带来可用性的问题。总的来说就是，数据存在的节点越多，分区容忍性越高，但要复制更新的数据就越多，一致性就越难保证。为了保证一致性，更新所有节点数据所需要的时间就越长，可用性就会降低。

回答二：

分区指的是，你整个分布式系统不再是连通的。 比如节点分成了两组，彼此之间无法通信。
这种情况，比其中一组全宕机更复杂。因为两组都可能独立对外提供服务。
但我们可以设想不提供P，也就是不允许出现分区的情况，是有可能同时提供AC两个特性的。 **实际上这在分布式系统中，并不受控。**所以一般认为P是必须提供的，所以AC需要权衡。也就是题主的看法。

回答三：

"Partition Tolerance" 这个形容词确实挺容易 confuse 的，《A Critique of the CAP Theorem》文章曾这样批评：we can interpret partition tolerance as meaning “a network partition is among the faults that are assumed to be possible in the system.”
It is misleading to say that an algorithm “provides partition tolerance,” and it is better to say that an algorithm “assumes that partitions may occur.”至于 Network Partition 应当理解为 CAP 理论中讨论的故障模型，这里需要注意 Network Partition 并非节点 Crash（节点 Crash 属于 FLP 的故障模型），更侧重于 "节点双方一时联系不上对方" 的一个状态。造成 Partition 的原因可能是网络不可达，也可能是 GC 的 Stop The World 阻塞太久，也可能是 CPU 彪到一个死循环上，总之种种血案。aphyr 曾整理过这么一批血案可以参考： [aphyr/partitions-post](https://link.zhihu.com/?target=https%3A//github.com/aphyr/partitions-post)

回答四：

就是一个很混乱且缺乏解释力的理论，那么较劲干啥。理论的原意大概是说你不可能设计一个系统在保证出现一些网络交换器故障导致一些批网络节点无法和另一批节点通信的情况下P依然保证数据一致性C，且保证服务可用A。这理论听听就行了。如果你是个这个领域的新人，学会大规模系统里需要考虑交换机和路由器坏掉的情况就可以了。

回答五：

C：集群中所有机器状态是一致的。
A：客户端访问集群中任意一个节点，总能得到"处理成功"的结果假设有五个节点：n1~n5 ，出现网络分区被分成两组：[n1~n2]和[n3~n5]，那么当n1出来客户端请求时（为了处理这种情况，也就是说"容忍网络分区"，即支持 P）：1：如果要保证C(一致性)，那么它需要把消息复制到所有节点，但是网络分区导致无法成功复制到n3~n5，所以它只能返回"处理失败"的结果给客户端。（这时系统就处于不可用状态，**即丧失了A**）2：如果要保证可用性A，那么n1就只能把消息复制到n2，而不用复制到n3~n5(或者无视复制失败/超时)，但n3同时也可能在处理客户端请求(譬如对同一个值进行修改)，n3也为了保证A而做了同样的处理。 那么 [n1~n2]和[n3~n5]的状态就不一致了，**于是就丧失了 C**。那么如果不支持P（也就是不容忍网络分区），也就是说**(很乐观的认为)假设**系统不会出现网络分区~

回答六：

1，P是分布式系统的起点，全称：network partition，常指拔网线和宕机，因为这两种现象，同伴是无法区分的，所以归为一类。分布式系统下，P是大概率事件，假设服务器开一年必宕机一次，则365台的集群必然天天宕机。数据分存这365台之上，则数据必然天天不完整。你设计的分布式系统能容忍吗？绝大多数是不能，不能则2，复制，是解决这一问题的标准做法3，复制，引发了C4，C引发了A

回答七：

满足P代表对失败的容忍，满足 A,C，而不满足 P 意味着当网络分区没有发生时，系统既能满足 A,也能满足C,而当存在网络分区时，将不再保证 A,C。实际上我们说一个分布式系统满足可用性，通常也附带了满足一定程度的P,因为失败一定存在，而不存在失败满足可用性又是如此容易；一致性也如此。
有一个等价的理论：在一个不可靠的分布式环境中中，无法同时满足活性(A)和安全性(C)。这个理论把 不可靠作为理论所处的模型的性质，隐含了系统需要能容忍失败。而 CAP 将P作为系统性质提出，隐含了分布式环境不可靠这一事实。

回答八：

C（一致性）：所有的节点上的数据时刻保持同步。A（可用性）：每个请求都能接受到一个响应，无论响应成功或失败。P（分区容错）：系统应该能持续提供服务，即使系统内部有消息丢失（分区）。高可用、数据一致是很多系统设计的目标，但是分区又是不可避免的事情：CA without P：如果不要求P（不允许分区），则C（一致性）和A（可用性）是可以保证的。但其实分区不是你想不想的问题，而是始终会存在，因此CA的系统更多的是允许分区后各子系统依然保持CA。CP without A：如果不要求A（可用），相当于每个请求都需要在Server之间强一致，而P（分区）会导致同步时间无限延长，如此CP也是可以保证的。很多传统的数据库分布式事务都属于这种模式。AP wihtout C：要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的NoSQL都属于此类。

回答九：

[Raft](https://link.zhihu.com/?target=http%3A//thesecretlivesofdata.com/raft/)
既然是分布式理論中的概念，那給題主一個Raft的演示吧，裡面涉及了網絡分化份額問題

